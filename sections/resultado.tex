\chapter{Resultados Preliminares e Considerações}
\section{Desempenho Computacional}
Na Figura \ref{fig:clustera} são apresentados os valores de \textit{speed up} das
simulações com diferentes números de processadores. Como se pode perceber, foi 
possível alcançar uma diminuição no tempo de execução com as simulações feitas em
paralelo, de forma que os valores de \textit{speed up} aumentam de forma linear,
aproximadamente. Na Figura \ref{fig:clusterb}, por sua vez, são apresentados os valores das
eficiências calculadas. Esses valores são
bem próximos para 2, 4 e 8 processos, mas uma queda começa a se tornar visível em
16 processos, sugerindo que, a partir desse número, a queda de eficiência se 
acentue.

\begin{figure}[ht]
    \centering
    \subfloat[][]{
        \label{fig:clustera}
        \includegraphics[scale=0.3]{linear}
    }
    ~ 
    \subfloat[][]{
        \label{fig:clusterb}
        \includegraphics[scale=0.3]{efs}
    }
    \caption[Resultados de aceleração e eficiência em função do número de processadores]{
        \subref{fig:clustera} Os círculos representam o \textit{speed up} obtido para cada
        número de processador utilizado. A reta em azul mostra uma regressão linear dos
        resultados. \subref{fig:clusterb} eficiência em função do número de processadores.
         }
\end{figure}

Outro resultado sobre desempenho computacional obtido foi o de tempo de
execução com as matrizes de condutância alteradas no Python. Como mostrado na 
Tabela \ref{tab:matrixG}, não é observada uma melhora de desempenho quando se 
usa a $G_g$ para 10 MNs. Entretanto, a medida em que se aumentam
o número de elementos neuronais para 50, 100 e 400 MNs, esta implementação
apresenta uma diminuição do tempo de execução de aproximadamente 23\%, 29\% e
26\% em relação à $G_c$ com
10, 50, 100 e 400 MNs, respectivamente. Isso sugere que as otimizações trazidas
por essa estratégia só são vantajosas para simulações que envolvam $G_g$
relativamente grandes. Como essas matrizes são esparsas, algoritmos que se
aproveitam dessa estrutura podem ser usados para reduzir ainda mais o tempo de
simulação.

\begin{table}[ht]
\caption{Tempo de execução das simulações relacionadas 
         à matriz de condutância para diferentes quantidades de MNs.}
\label{tab:matrixG}
\centering
    \begin{tabular}{ccccc}\hline 
        & 10 MNs & 50 MNs & 100 MNs & 400 MNs \\ \hline 
        $G_c$ & 5.21 s & 21.22 s & 42.34 s & 170.97 s \\ 
        $G_g$ & 5.63 s & 16.50 s & 30.01 s & 125.31 s \\ 
	\hline
    \end{tabular}
\end{table}

Os resultados mostrados anteriormente são positivos, mas possuem muitas
limitações. Em primeiro lugar, apesar das melhoras obtidas com a matriz
$G_g$, a diferença de tempo de execução entre as versões Java e Python
ainda são muito grandes e outras soluções precisariam ser exploradas
para diminuir essa discrepância.

Em segundo lugar, é preciso enfatizar que os MNs das simulações
realizadas no \textit{cluster} não recebem nenhuma entrada sináptica
de INs. A paralelização desse tipo de configuração é
facilmente obtida e dificilmente apresenta resultados negativos, pois,
como as unidades motoras são independentes umas das outras, os
processos podem executar em paralelo sem a necessidade de se comunicar. 
Em um cenário mais realista, como o que está sendo estudado na Figura
\ref{fig:circuit}, MNs em um processo podem precisar receber informações
geradas em outro. Por causa da alta complexidade de conexões
sinapticas, seriam necessárias muitas comunicações entre processos
e isso poderia causar uma diminuição significativa nos valores de
\textit{speed up}.

Isso, de qualquer forma, não tira a validade desse resultado, visto
que existem maneiras de paralelizar simuladores de redes neuronais
complexas mantendo um bom desempenho computacional \cite{morrison05}.
Entretanto, pode-se perceber que os resultados obtidos no \textit{cluster},
em essência, poderiam ser reproduzidos em computadores comuns por meio
da utilização de \textit{threads} ou processos. O uso destas estratégias,
na verdade, seria preferível à utilização de um \textit{cluster}, pois
envolvem menos alterações na estrutura do código do simulador e
possibilitam que outras pessoas interessadas em utilizar esse
\textit{software} possam fazer simulações com um bom desempenho
computacional em seus próprios computadores.

A utilização de \textit{threads} no Python, entretanto, não é
possível por causa do \textit{Global Interpreter Lock} (GIL). Esse
mecanismo faz com que apenas uma \textit{thread} exista por processo.
Uma alternativa para essa limitação é o uso de processos para realizar
a paralelização do código. Esse recurso pode ser explorado no Python
através da biblioteca \textit{Multiprocessing} e pode trazer melhoras
significativas, especialmente quando há a possibilidade de se trabalhar
com memória compartilhada. O código do simulador, no entanto, teria que
passar por grandes modificações e sua estrutura de orientação a objetos
não é muito compatível com essa biblioteca. Além disso, a elevado 
volume de comunicações entre processos aqui também seria um gargalo.

Sendo assim, de acordo com as observações feitas, convém propor outras
estratégias para alcançar um aumento no desempenho computacional. Para
esse fim, o Cython surge como uma boa alternativa e será explorado 
nesse trabalho, já que seu uso pode ocasionar em tempos de execução
muitas vezes similares ao de um código escrito em C \cite{gorelick14}.
Vale notar que o uso de \textit{clusters} ainda seria uma boa solução,
mas por causa da dificuldade de tal implementação e da existência de
outras opções, esta é postergada para trabalhos futuros.

%\begin{table}[ht!]
%\caption{Tempo de execução das simulações relacionadas 
%         à matriz de condutância para diferentes tempos simulados.}
%\label{tab:matrixGt}
%\centering
%    \begin{tabular}{cccc}\hline 
%        & 200 ms & 500 ms & 1000 ms \\ \hline 
%        $G_c$ & 21.52 s & 53.03129 s &  s \\ 
%        $G_g$ & 16.55 s & 41.15 s &  s \\ 
%	\hline
%    \end{tabular}
%\end{table}

\section{Disparos dos Elementos Neuronais}
Na Figura \ref{fig:spkOldxNew}, cada MN é representado por índices, que 
são distribuídos em ordem crescente no eixo vertical da figura e atribuídos de
forma que seus valores sejam diretamente proporcionais ao tamanho dos
neurônios aos quais estão associados. O eixo horizontal representa os instantes
de disparo, que podem ser observados para cada índice. 

Pode-se perceber que o uso das
parametrizações nova e antiga resulta em padrões de disparos claramente
distintos. Na nova, os MNs disparam de forma ordenada, do menor para o maior 
(com algumas pequenas variações).
Por outro lado, na antiga, a alta inibição das CRs nos MNs faz com que
alguns destes, em certos instantes, atrasem seus disparos. Como resultado, o
gráfico dos instantes de disparos, nesse caso, possui um aspecto ``fragmentado''.

\begin{figure}[ht]
	\center
	\includegraphics[scale=0.4]{spkOldxNew.png}
    \caption[Momentos de disparo dos somas de todos os motoneurônios simulados.]{
             Momentos de disparo dos somas de todos os motoneurônios simulados.
             O eixo das ordenadas representa os MNs e o eixo das abcissas, os
             instantes de disparo. Os disparos dos MNs, com
             parametrização nova e antiga das CRs, estão sobrepostos.
            }
	\label{fig:spkOldxNew}
\end{figure}

Essa característica dos instantes de disparos usando a parametrização antiga
pode ser melhor observado na Figura 
\ref{fig:spkTimes}. É possível perceber na Figura
\ref{fig:spkTimes}\subref{fig:spkOldZoom1} que algumas unidades com índice 
próximo a 25 dispararam em 340 ms. Por volta de 25 ms antes, unidades com
índice perto de 60 já tinham disparado. Na Figura
\ref{fig:spkTimes}\subref{fig:spkOldZoom2}, pode-se perceber que uma unidade
do tipo FR, de índice 801, dispara mais de 60 ms antes do que a do índice
anterior, que é do tipo S. Dessa forma, esses gráficos indicam que ocorreu
uma certa inversão na ordem de recrutamento.

\begin{figure}[ht]
    \centering
    \subfloat[][]{
        \label{fig:spkOldZoom1}
        \includegraphics[scale=0.275]{spkOldZoom1.png}
    }
    ~ 
    \subfloat[][]{
        \label{fig:spkOldZoom2}
        \includegraphics[scale=0.25]{spkOldZoom2.png}
    }
    \caption[Visão de um intervalo reduzido dos disparos dos motoneurônios na
             parametrização antiga.]{
             Visão de um intervalo reduzido dos disparos dos motoneurônios na 
             parametrização antiga.
             \subref{fig:spkOldZoom1} Instantes de disparos dos primeiros
             motoneurônios nos instantes iniciais. \subref{fig:spkOldZoom2}
             Instantes de disparos dos últimos motoneurônios nos instantes
             finais.
         }
    \label{fig:spkTimes}
\end{figure}

Para verificar se a força inibitória das CRs poderiam estar causando esse
comportamento, apenas os valores das condutâncias entre CRs e MNs da
parametrização antiga foram substituídos por aqueles descrito em
\citeonline{maltenfort98}. O resultado dessa simulação é mostrado 
na Figura \ref{fig:spkMaltenfort}\subref{fig:spkOldMaltenfort}. A aparência
fragmentada dos disparos de MNs aparentemente desapareceu, mas
uma visão de um intervalo de tempo reduzido, como o da Figura
\ref{fig:spkMaltenfort}\subref{fig:spkOldMaltenfortZoom}, mostra que
o padrão se tornou menos evidente. Esse resultado, no entanto, deixa em aberto
como que as CRs estão influenciado os MNs, sendo necessário realizar
novamente algumas validações do circuito de inibição recorrente.

\begin{figure}[ht]
    \centering
    \subfloat[][]{
        \label{fig:spkOldMaltenfort}
        \includegraphics[scale=0.25]{spkOldMaltenfort.png}
    }
    ~ 
    \subfloat[][]{
        \label{fig:spkOldMaltenfortZoom}
        \includegraphics[scale=0.275]{spkOldMaltenfortZoom.png}
    }
    \caption[Momentos de disparo dos somas de todos os motoneurônios
             simulados com as condutâncias reportadas por
             \citeonline{maltenfort98}.]{Momentos de disparo dos somas
             de todos os motoneurônios simulados com as condutâncias
             reportadas por
             \citeonline{maltenfort98}. \subref{fig:spkOldMaltenfort} Visão 
             geral. \subref{fig:spkOldMaltenfortZoom} 
             Visão dos disparos em um intervalo reduzido.
         }
    \label{fig:spkMaltenfort}
\end{figure}

\section{Parametrizações}
As parametrizações foram realizadas na ordem em que são apresentadas.
Para realizá-las, parâmetros relacionados com as características 
estudadas foram ajustados em várias simulações até que se fosse obtido
um resultado razoavelmente próximo ao que é descrito na literatura.
De forma geral, a forma como os parâmetros foram alterados foi por
tentativa e erro, mas sempre guiada por um conhecimento sobre a CR 
ou o circuito de inibição recorrente.

\subsection{Potencial Excitatório Pós Sinápico nas Células de Renshaw}
A constante de tempo de membrana dos modelos aqui utilizados é definida 
como $\tau=R_mC_m$, sendo $R_m$ e $C_m$ a resistência e capacitância 
específicas, respectivamente. Essa grandeza expressa, de forma geral, 
quão rápido é o carregamento ou descarregamento da membrana \cite{sterratt11}.
Dessa forma, optou-se por variar o valor de resistência específica
da CR, mantendo o padrão de $C_m = \text{1 }\mu\text{Fcm}^{-2}$.

A resistência específica foi ajustada para reproduzir os 
seguintes resultados descritos na literatura:

\begin{itemize}
    \item \citeonline{walmsley81}: Medições da atividade intracelular em
        CRs após uma estimulação de raízes ventrais forneceram alguns
        dados sobre os PEPSs resultantes.
    \item \citeonline{williams09}: Nesse trabalho de simulações, os
        autores adotam 7.6 ms de tempo de subida e 50 ms de duração 
        dos PEPSs descritos por \citeonline{walmsley81}.
\end{itemize}

Para simular o experimento descrito, uma corrente suficiente para causar
um único potencial de ação foi injetada no soma de um
MN do tipo S que fazia sinapse com uma CR. O resultado mostrado na Figura
\ref{fig:RCepsp} foi obtido com $R_m=\text{8500 }\Omega\text{cm}^2$. O PEPS é
iniciado em 10.5 ms e atinge o pico em 16.15 ms, configurando, assim, um
tempo de subida de 6.10 ms. A duração total observada foi de aproximadamente
50 ms.

\begin{figure}[ht!]
	\center
	\includegraphics[scale=0.8]{EPSP.eps}
    \caption[PEPS em uma CR.]{Potencial excitatório pós sináptico 
        em uma célula de Renshaw.}
	\label{fig:RCepsp}
\end{figure}

\subsubsection{Limitações}
O tipo de estimulação utilizado no experimento pode facilmente recrutar
mais de um MN. Dessa forma, a parametrização não levou em conta a
amplitude do PEPS. Esse característica, juntamente com a força sináptica
dessa conexão, foi analisada junto com estudos
sobre conectividade e será abordado na seção \ref{sec:conn}.

O tempo de subida foi um pouco maior do que o utilizado por
\citeonline{williams09}. O aumento da resistência específica aumentaria
o tempo de subida aqui apresentado, mas isso causaria um aumento
na duração do PEPS. Sendo assim, a parametrização realizada foi tomada
para satisfazer razoavelmente as duas características.

\subsection{Características dos disparos das Células de Renshaw}
Quando o potencial de membrana do modelo da CR utilizado
ultrapassa o limiar de disparo, a condutância de sódio é acionada e
inicia a despolarização da célula. Por outro lado, as condutâncias de 
potássio rápida e lenta causam a repolarização, sendo que esta
última tem mais influência sob a pós hiperpolarização (do inglês
\textit{afterhyperpolarization}, AHP) da célula.

A AHP é uma importante característica da CR. Antes de fazer essa
parametrização, entretanto, é preciso definir quando ela irá disparar
um potencial de ação. Sabe-se que essas células possuem
baixo limiar \cite{uchiyama03a}, mas não existem estudos quantitativos
especificamente sobre esse parâmetro. O valor do limiar é calculado como

\begin{equation}
V_{l}=\frac{I_rR_m}{a}
\label{eq:vth}
\end{equation}

com $V_l$ sendo a tensão de limiar, $I_r$ a corrente de reobase e $a$ a 
área superficial total. 

Outra característica afetada pela dinâmica das condutâncias dependentes
da voltagem é a curva de frequência de disparo \textit{versus} corrente
injetada (FxI), que também reflete a forma como a CR se adapta a uma
dada corrente.

Os parâmetros de limiar, comprimento, diâmetro e intensidade e dinâmica
das condutâncias do modelo da CR podem ser alterados para reproduzir as
características citadas. As parametrizações feitas 
para obtê-los são baseadas nas seguintes referências:

\begin{itemize}
    \item \citeonline{hultborn79}: Curvas de FxI para diferentes correntes
        (Figura \ref{fig:HP79}\subref{fig:fxiRC}),
        sendo que os disparos só começam a ocorrer por volta de 0.5 nA;
        AHP após um breve pulso de corrente injetada apresentou uma 
        amplitude de -2 mV e duração por volta de 30 ms
        (Figura \ref{fig:HP79}\subref{fig:AHPRC}).
    \item \citeonline{fyffe90}: Diâmetro médio de 27 $\mu$m.
    \item \citeonline{bui03}: Área superficial média do soma e do dendrito
        de 1753.8 $\mu\text{m}^2$ e 16756 $\mu\text{m}^2$, respectivamente.
\end{itemize}

Usando o $R_m$ obtido na seção anterior,
$a=\text{1753.8+16756 }\mu\text{m}^2$ e considerando que $I_r=\text{0.5 }$ nA,
a Equação (\ref{eq:vth}) resulta em $V_l=\text{22.9678 }$ mV.
Tomando a CR por um cilindro, sua área superficial total será 
$a=\text{1753.8+16756}=\pi ld$. Dessa forma, $l=\text{218.2168 }\mu$m.

Com esses valores, torna-se possível parametrizar a AHP e a curva FxI.
Como o modelo de condutância utilizado é baseado em pulsos \cite{destexhe94a},
as variáveis de ativação de cada condutância podem ser expressas como 
exponenciais com taxas de crescimento ou decaimento dependendo de variáveis
de transição.

As variáveis de transição $\alpha_N$ e $\beta_N$, relacionadas com a
dinâmica dos canais de potássio rápido, foram aumentadas para que esses
canais se fechassem antes da membrana voltar ao nível de repouso (0 mV). 
Sendo assim, os canais de potássio lento, com $\alpha_Q$ e $\beta_Q$,
puderam ser ajustados para se obter as taxas de disparos e adaptação
apropriados.

O valor de $\beta_Q$ foi ajustado até se obter uma localização do pico da
AHP semelhante à da Figura \ref{fig:HP79}\subref{fig:AHPRC},
que se encontra mais ao centro de sua duração. Isso significa
alterar a velocidade de fechamento do canal para que este se não se feche
muito próximo ao início da AHP.

Considerando uma sequência de potenciais
de ação, uma diminuição no valor de $\alpha_Q$ faz com que o decaimento
da exponencial da variável de ativação seja mais lento. Isso permite que 
estes possam se sobrepor, fazendo com que exista uma corrente iônica
abaixando o potencial de membrana para o equilíbrio do canal de potássio
lento (-10 mV). Inicialmente, essa corrente é relativamente pequena, mas
ela cresce de forma cumulativa até o momento em que os efeitos das primeiras
exponenciais gerando essa corrente desapareça. Esse fenômeno, então, gera 
uma adaptação na frequência de disparo das CRs.

Por fim, a amplitude do AHP foi obtida ajustando os valores máximos
das condutâncias de potássio rápida e lenta.

Detalhes sobre a AHP podem ser visto na Figura \ref{fig:RCahp}. O pico 
observado foi de -2 mV. Sua duração foi de aproximadamente 35 ms,
calculada de 15 ms até o instante com 10\% do valor do pico, que foi em
50 ms.

\begin{figure}[ht!]
	\center
	\includegraphics[scale=0.8]{AHP.eps}
    \caption[AHP em uma CR.]{Pós hiperpolarização de
        uma célula de Renshaw.}
	\label{fig:RCahp}
\end{figure}

A curva FxI obtida é mostrada na Figura \ref{fig:RCfxi}.
O primeiro e segundo potencial de ação é entendido como o 
primeiro potencial, enquanto que o segundo e terceiro é o
segundo intervalo, e assim por diante. O regime estacionário foi
considerado como sendo após 80 ms. A saturação observada foi 
causada pela período refratário absoluto da célula, que é de 1 ms.

\begin{figure}[ht!]
	\center
	\includegraphics[scale=0.8]{FxI.eps}
    \caption[FxI em uma CR.]{Curva de frequência de disparo
    \textit{versus} corrente injetada de uma célula de Renshaw.}
	\label{fig:RCfxi}
\end{figure}

Com os resultados obtidos, a resistência de entrada $R_i=\frac{R_m}{a}$
resultante foi de 45.92 M$\Omega$. Como esperado, esse valor é maior que 
a resistência de entrada do menor MN.

\subsubsection{Limitações}
A curva FxI apresentada se aproximou do que foi descrito na literatura, 
mas o tempo de duração da adaptação, que é maior para correntes mais
altas, não. Em geral, essa duração foi sempre menor no modelo aqui descrito.
Isso é ilustrado na Figura \ref{fig:FxIcomp}.

\begin{figure}[ht]
    \centering
    \subfloat[][]{
        \label{fig:refmemb}
        \includegraphics[scale=0.8]{refmemb}
    }
    \hspace{-1cm}
    \subfloat[][]{
        \label{fig:resmemb}
        \includegraphics[scale=0.4]{FxI_RC.eps}
    }
    \caption[Comparação dos potenciais de membrana para uma corrente injetada
        de 12 nA]{
        Comparação dos potenciais de membrana para uma corrente injetada
        de 12 nA. \subref{fig:refmemb}  Tempo da adaptação em uma
        CR tem uma duração de aproximadamente 30 ms \cite{hultborn79}.
        \subref{fig:resmemb} Resultado obtido pelo modelo de uma CR nas
        mesmas condições.
         }
    \label{fig:FxIcomp}
\end{figure}

\subsection{Potencial inibitório pós sináptico de célula de Renshaw}
As condutâncias das CRs sobre cada tipo de MN foram ajustadas, levando em
conta os seguintes dados experimentais:

\begin{itemize}
    \item \citeonline{vankeulen79}: PIPS em MNs causados por CRs.
    \item \citeonline{fyffe91}: Conexões sinápticas de CRs para MNs do 
        tipo $\alpha$ são localizadas nos dendritos.
    \item \citeonline{uchiyama03a}: Procedimento para estimar PIPS de
        acordo com o tipo de MN.
\end{itemize}

Após sucessivas simulações, o resultado final obtido é mostrado na 
Figura \ref{fig:PIPSres}. Os picos foram de -26.12 $\mu$V, -14.03 $\mu$V e
7.00 $\mu$V para MNs do tipo S, FR e FF, respectivamente.

\begin{figure}[ht!]
	\center
	\includegraphics[scale=0.8]{IPSP.eps}
    \caption[PIPS de uma CR.]{Potencial inibitório pós sináptico
        de célula de Renshaw em diferentes tipos de motoneurônios.}
	\label{fig:PIPSres}
\end{figure}

\subsection{Atividade espontânea da célula de Renshaw}
Para obter uma taxa de disparos espontâneos de 7 pps \cite{walmsley81},
foi necessário alterar o valor da condutância máxima do ruído agindo sobre
a CR. Como visto na Figura \ref{fig:spont}, a taxa está condizente com 
o esperado.

\begin{figure}[ht!]
	\center
	\includegraphics[scale=0.8]{spont.eps}
    \caption[Disparos espontâneos de uma CR.]{Disparos espontâneos de uma CR.}
	\label{fig:spont}
\end{figure}

\subsection{Conectividade no Circuito de Inibição Recorrente}
\subsubsection{Limitações}
\label{sec:conn}
